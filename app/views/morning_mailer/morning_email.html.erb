<% @versions_tested.each do |version| %>
  <% data = @version_data[version] %>
  <h3>
    <% if data[:status] == :passing %>
      <a clicktracking=off href=<%= data[:link] %> <%=@make_green%>>
    <% elsif data[:status] == :mixed %>
      <a clicktracking=off href=<%= data[:link] %> <%=@make_yellow%>>
    <% elsif data[:status] == :checksums %>
      <a clicktracking=off href=<%= data[:link] %> <%=@make_blue%>>
    <% elsif data[:status] == :failing %>
      <a clicktracking=off href=<%= data[:link] %> <%=@make_red%>>
    <% else %>
      <a clicktracking=off href=<%= data[:link] %>>
    <%end%>
      <%= version %>
    </a> (<%= "#{data[:computer_counts][:total]} " + "computer".pluralize(data[:computer_counts][:total])%> tested to date)
  </h3>
  <ul>
    <li> <b> Author: </b> <%= version.author %> </li>
    <li> <b> Commit Message: </b> <%= version.log %> </li>
    <li> <%= data[:case_count] %> cases submitted </li>
    <% data[:mixed_cases].each do |tcv| %>
      <li>
        <samp> 
          <a <%=@make_yellow%> clicktracking=off href=<%= data[:case_links][tcv] %>>
            <%= tcv.test_case.name %>
          </a> 
        </samp> (<b>Failures: </b> <%= data[:fail_counts][tcv].to_s %>; <b> Successes: </b> <%= data[:pass_counts][tcv].to_s%>)
      </li>
    <%end%>
    <% data[:checksum_cases].each do |tcv| %>
      <li>
        <samp> 
          <a <%=@make_blue%> clicktracking=off href=<%= data[:case_links][tcv] %>>
            <%= tcv.test_case.name %>
          </a> 
        </samp> (<%= data[:computer_counts][tcv].to_s + ' ' + 'computer'.pluralize(data[:computer_counts][tcv])%>; multiple distinct checksums)
      </li>
    <%end%>
    <% data[:failing_cases].each do |tcv| %>
      <li>
        <samp> 
          <a <%=@make_red%> clicktracking=off href=<%= data[:case_links][tcv] %>>
            <%= tcv.test_case.name %>
          </a> 
        </samp> (<%= data[:computer_counts][tcv].to_s + ' ' + 'computer'.pluralize(data[:computer_counts][tcv])%>)
      </li>
    <%end%>
    <% data[:problematic_passing].each do |tcv| %>
      <li>
        <samp>
          <a <%=@make_green%> clicktracking=off href=<%= data[:case_links][tcv]%>>
            <%= tcv.test_case.name %>
          </a>
        </samp>
        <% if data[:slow_cases][tcv] %>
          <% if data[:inefficient_cases][tcv] %>
            (runtime and memory usage increases)
          <% else %>
            (runtime increase)
          <% end %>
        <% else %>
          (memory usage increase)
        <% end %>
        <ul>
          <% if data[:slow_cases][tcv] %>
            <% data[:slow_cases][tcv].each_pair do |runtime_type, hash| %>
              <li> The following computers show increased <%= runtime_type %> runtimes:
                <% runtime_query = case runtime_type when :rn then :runtime_seconds; when :re then :re_time; else :total_runtime_seconds end %>
                <ul>
                  <% data[:slow_cases][tcv][runtime_type].each_pair do |computer, hash| %>
                    <li> <%= computer.name %>:
                      <span <%= @make_green %>>
                        <%= data[:slow_cases][tcv][runtime_type][computer][:better].send(runtime_query) %> sec
                      </span> &#8594; <span <%= @make_red %>>
                        <%= data[:slow_cases][tcv][runtime_type][computer][:current].send(runtime_query) %> sec
                      </span>
                    </li>
                  <% end %>
                </ul>
              </li>
            <% end %>
          <% end %>
          <% if data[:inefficient_cases][tcv] %>
            <% data[:inefficient_cases][tcv].each_pair do |run_type, hash| %>
              <li> The following computers show increased <%= run_type %> memory usage:
                <% memory_query = run_type == :rn ? :rn_mem : :re_mem %>
                <ul>
                  <% data[:inefficient_cases][tcv][run_type].each_pair do |computer, hash| %>
                    <li> <%= computer.name %>:
                      <span <%= @make_green %>>
                        <%= data[:inefficient_cases][tcv][run_type][computer][:better].send(memory_query) / (1024**2) %> GB
                      </span> &#8594; <span <%= @make_red %>>
                        <%= data[:inefficient_cases][tcv][run_type][computer][:current].send(memory_query) / (1024**2) %> GB
                      </span>
                    </li>
                  <% end %>
                </ul>
              </li>
            <% end %>
          <% end %>
        </ul>
      </li>
    <% end %>
  </ul>
<%end%>

<% if @versions_tested.empty? %>
  <p>
    No tests were run in the last 24 hours. This e-mail serves to let you know
    that everything is running fine. Visit 
    <a clicktracking=off href=<%=@root_url%>> MESA Test Hub </a>
    for more details.
  </p>
<% end %>

